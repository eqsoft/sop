<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>utils.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title=""></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/db.html">db</a></li>
            
                <li><a href="../classes/env.html">env</a></li>
            
                <li><a href="../classes/gui.html">gui</a></li>
            
                <li><a href="../classes/main.html">main</a></li>
            
                <li><a href="../classes/som.html">som</a></li>
            
                <li><a href="../classes/utils.html">utils</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: utils.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * Utilities class
 *  
 * @class utils
 **/ 
&#x27;use strict&#x27;;
const {Cc, Ci, Cu, Cr, Cm} = require(&quot;chrome&quot;);

var system = require(&quot;sdk/system&quot;);
var windows = require(&quot;sdk/windows&quot;).browserWindows;
var winutils = require(&#x27;sdk/window/utils&#x27;);

Cu.import(&quot;resource://gre/modules/FileUtils.jsm&quot;);
module.metadata = {
  &quot;stability&quot;: &quot;unstable&quot;
};

function log(msg) {
	console.log(msg);
	if (system.name == &quot;Fennec&quot;) {
		console.error(&quot;log: &quot;  + msg);
	}
}

function err(msg) {
	if (system.name == &quot;Fennec&quot;) {
		console.error(&quot;error: &quot;  + msg);
	}
	else {
		console.error(msg);
	}
}

function logWindows(window,wr) {
	log(typeof wr);
	log(window.tabs.length);
	var wr2 = winutils.getMostRecentBrowserWindow();
	log(wr === wr2);
	/*
	var wjs = w.content.wrappedJSObject;
	for each (var win in windows) {
		log(&quot;win: &quot; + win.title + &quot; : &quot; + (window === win));	
		for each (var tab in win.tabs) {
			log(&quot;tab: &quot; + tab.title + &quot; is pinned: &quot; + tab.isPinned + &quot; content: &quot; + tab.content);
		}
	}
	*/ 
}

function contains(a, obj) {
    for (var i = 0; i &lt; a.length; i++) {
        if (a[i] === obj) {
            return i;
        }
    }
    return -1;
}

function isMobile() {
	return (system.name == &quot;Fennec&quot;);
}

/**
 * zip functions
 */ 

/**
 * @description unzip package to directory
 * @param aZipFile nsILocalFile source zip file
 * @param aDir nsIFile target directory
 */ 

function extractFiles (aZipFile, aDir) {
	function getTargetFile(aDir, entry) {
		
		let target = aDir.clone();
		entry.split(&quot;/&quot;).forEach(function(aPart) {
			target.append(aPart);
		});
		return target;
	}

	let zipReader = Cc[&quot;@mozilla.org/libjar/zip-reader;1&quot;].createInstance(Ci.nsIZipReader);
  
	try {
		zipReader.open(aZipFile);
	}
	catch (e) {
		var msg = &quot;File:&quot; + aZipFile.path + &quot;\n\n is either broken or not a ZIP file.&quot;;
		err(msg);
		//var prompts = Cc[&quot;@mozilla.org/embedcomp/prompt-service;1&quot;].getService(Ci.nsIPromptService);
		//prompts.alert(null, &quot;Unzip&quot;, &quot;File:&quot; + aZipFile.path + &quot;\n\n is either broken or not a ZIP file.&quot;);
		return;
  	 }
  	  
	try { 	// create directories first
		let entries = zipReader.findEntries(&quot;*/&quot;);
		while (entries.hasMore()) {
			var entryName = entries.getNext();
			let target = getTargetFile(aDir, entryName);
			if (!target.exists()) {
				try {
					target.create(Ci.nsIFile.DIRECTORY_TYPE,
					FileUtils.PERMS_DIRECTORY);
				}
				catch (e) {
					err(e);         
					err(&quot;extractFiles: failed to create target directory for &quot; +
						&quot;extraction file = &quot; + target.path);
				}
			}
		}

		entries = zipReader.findEntries(null);
		while (entries.hasMore()) {
			let entryName = entries.getNext();
			let target = getTargetFile(aDir, entryName);
			//log(&quot;target:&quot; + target.path);
			//log(&quot;entry:&quot; + entryName);
			if (target.exists()) {
				continue;
			}
			try {
				zipReader.extract(entryName, target);
				target.permissions |= FileUtils.PERMS_FILE;
			}
			catch (e) {
				err(e);
				//err(&quot;Failed to set permissions &quot; + aPermissions.toString(8) + &quot; on &quot; + target.path);
			}
		}
	}
	finally {
		zipReader.close();
		/*
		var prompts = Cc[&quot;@mozilla.org/embedcomp/prompt-service;1&quot;].getService(Ci.nsIPromptService); // Fehlermeldung
		var result = prompts.confirm(null, &quot;Open Directory&quot;, &quot;Do you want to open the new unzipped directory?&quot;);    
		if(result) {
			aDir.reveal();
		}
		*/ 
	}
}

function showPicker() {
	var nsIFilePicker = Ci.nsIFilePicker;
	var fp = Cc[&quot;@mozilla.org/filepicker;1&quot;].createInstance(nsIFilePicker);
	//var selectStr = document.getElementById(&quot;unzip-properties&quot;).getString(&quot;unzip.select&quot;);
	var selectStr = &quot;select&quot;;
	var win = winutils.getMostRecentBrowserWindow();
	fp.init( win, selectStr, nsIFilePicker.modeOpen);
	var rv = fp.show();
	if (rv == nsIFilePicker.returnOK || rv == nsIFilePicker.returnReplace) {
		var file = fp.file;
		
		var uri = Services.io.newFileURI(file);
		// url is a nsIURI; 
		var url = uri.QueryInterface(Ci.nsIURL);
		var name=url.fileBaseName;
		var parent = file.parent;
		/*
		parent.append(name);
		var extractDir= uniqueFile(parent);
		*/ 
		//var extractDir = Components.classes[&quot;@mozilla.org/file/directory_service;1&quot;]
		//				.getService(Components.interfaces.nsIProperties).get(&quot;Desk&quot;, Components.interfaces.nsIFile);
		//extractDir.append(name);
		//log(extractDir.path);                
		extractFiles(file,parent);
	}
}

function uniqueFile (aLocalFile) {
	var collisionCount = 0;
	while (aLocalFile.exists()) {
		collisionCount++;
		if (collisionCount == 1) {
			// Append &quot;(2)&quot; before the last dot in (or at the end of) the filename
			// special case .ext.gz etc files so we don&#x27;t wind up with .tar(2).gz
			if (aLocalFile.leafName.match(/\.[^\.]{1,3}\.(gz|bz2|Z)$/i)) {
				aLocalFile.leafName = aLocalFile.leafName.replace(/\.[^\.]{1,3}\.(gz|bz2|Z)$/i, &quot;(2)$&amp;&quot;);
			}
			else {
				aLocalFile.leafName = aLocalFile.leafName.replace(/(\.[^\.]*)?$/, &quot;(2)$&amp;&quot;);
			}
		}
		else {
			// replace the last (n) in the filename with (n+1)
			aLocalFile.leafName = aLocalFile.leafName.replace(/^(.*\()\d+\)/, &quot;$1&quot; + (collisionCount + 1) + &quot;)&quot;);
		}
	}
	return aLocalFile;
}

function addExposedProps(obj) {
	var key, i;
	if (typeof(obj) === &#x27;undefined&#x27; || obj === null) {
		return;
	}
	// Note that this code path is for Objects and Arrays
	if (typeof(obj) === &#x27;object&#x27;) {
		if (!(&#x27;__exposedProps__&#x27; in obj)) {
			obj[&#x27;__exposedProps__&#x27;] = {};
		}
		// WARNING: I don’t actually use this if-block in my code, since it doesn’t work.
		// But for interest’s sake…
		/*
		if (Array.isArray(obj)) {
			obj[&#x27;__exposedProps__&#x27;][&#x27;length&#x27;] = &#x27;rw&#x27;;
		}
		*/ 
		for (key in obj) {
			if (key === &#x27;__exposedProps__&#x27;) {
			continue;
		}
		obj[&#x27;__exposedProps__&#x27;][key] = &#x27;rw&#x27;;
		addExposedProps(obj[key]);
		}
	}
}
function findIn(obj,key) {
	return key.findIn(obj);
}

String.prototype.findIn = function (multi) {
    multi = multi || &#x27;&#x27;;
    var val = this.valueOf();
    if(typeof multi == &#x27;object&#x27; || typeof multi == &#x27;array&#x27;)
    {
        if(val in multi)
        {
            return multi[val];
        }
        else
        {
            for(var x in multi)
            {
                var found = this.findIn(multi[x]);
                if(found != false)
                {
                    return found;
                }
            }
        }
    }
    return false;
};

exports.log = log;
exports.err = err;
exports.logWindows = logWindows;
exports.contains = contains;
exports.isMobile = isMobile;
exports.extractFiles = extractFiles;
exports.addExposedProps = addExposedProps;
exports.findIn = findIn;

exports.__exposedProps__ = {
	log 		: &quot;r&quot;,
	err		: &quot;r&quot;,
	logWindows	: &quot;r&quot;,
	findIn		: &quot;r&quot;
};

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
